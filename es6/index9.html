<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Pure HTML - Cydran Repeats and Templates</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link rel="stylesheet" href="node_modules/bulma/css/bulma.min.css" type="text/css" />
		<script src="node_modules/axios/dist/axios.min.js"></script>
		<script src="node_modules/cydran/dist/cydran.min.js"></script>
		<script>
			window.onload = function () {

				const builder = cydran.builder;
				const Component = cydran.Component;
				const Stage = cydran.Stage;

				const templates = ["Main", "NoData", "WkItem"].map((t) => {
					const tempTemplate = document.querySelector("template[id=" + t + "]").innerHTML.trim();
					return {"key": t, "value": tempTemplate};
				});

				const TEMPLATE = (key) => {
					return templates.find((t) => t.key == key).value;
				};

				class App extends Component {
					constructor() {
						super(TEMPLATE("Main"));
						this.wkCount = 0;
						this.minSize = 0;
						this.maxSize = 10;
						this.noData = "No data present...";
						this.dataList = new Array(this.wkCount);
						this.watch("m().wkCount", this.adjustArray);
					}

					adjustArray() {
						while (this.wkCount > this.dataList.length) {
							this.dataList.push({'value': this.dataList.length});
						}
						while (this.wkCount < this.dataList.length) {
							this.dataList.pop();
						}
					}
				}

				const wkappName = "mainapp";
				builder("body")
					.withDebugLogging()
					.withPrototype(App.name, App)
					.withImplicit("NoData", TEMPLATE("NoData"))
					.withImplicit("WkItem", TEMPLATE("WkItem"))
					.withInitializer(stage => {
						stage.setComponentFromRegistry(App.name);
					})
					.build()
					.start();
			};

		</script>
	</head>

	<body></body>

	<template id="Main">
		<section class="section">
			<div class="container">
				<span class="title is-4">
					Cydran components in structures with restricted child node types<br>
				</span>
				<br /><br />
				<div class="columns">
					<div class="column is-one-third field">
						<div class="field-label is-normal">
							<label class="label">Index: {{m().wkCount}}</label>
						</div>
						<div class="field-body">
							<div class="field">
								<div class="control">
									<input class="input is-primary" type="range" min="{{m().minSize}}" max="{{m().maxSize}}"
										value="{{m().wkCount}}" c:model="m().wkCount" />
								</div>
							</div>
						</div>
					</div>
					<div class="column is-two-thirds">
						<table class="table is-striped is-bordered is-fullwidth">
							<tbody c:repeat="m().dataList" c:repeat:mode="generated">
								<template type="empty">
									<tr>
										<td>
											<c:region component="NoData"></c:region>
										</td>
									</tr>
								</template>
								<template type="item">
									<c:region component="WkItem"></c:region>
								</template>
							</tbody>
						</table>
					</div>
				</div>
		</section>
	</template>

	<template id="WkItem">
		<tr>
			<td>Item #{{v().value}}</td>
		</tr>
	</template>

	<template id="NoData">
		<span>No data available...</span>
	</template>

</html>